.. include:: substitutions.txt
.. |instr| replace:: flex
.. |instrn| replace:: Fleximeter

|m3| Data Import
================

|m4| can access data acquired from measurement instruments operated by previous |m3| software. By enabling the |m3| data import function, you can open any |m3|
database, navigate through stored tests and get a preview of images, then convert the requested tests to the latest |m| file format. 

Once the test data has been converted and stored into the newer format, it can be opened and used exactly as any other |m| file, taking advantage of nice vector
plotting, flexible data storage, reporting, and advanced math operations. 

===========
Limitations
===========

* The |m3| data import function works only on |win| OS.
* |m3| tests does not contain all the metadata generated by a newer instrument. Part of the metadata needed for correct interoperability is guessed or simply
  filled with a default.
* For the above reason, |m3| data import should be considered experimental and might lead to unexpected or wrong results. 

=================================
Enabling the |m3| import function
=================================

The import function can be configured in the :ref:`preferences` panel. This panel is accessible from the Help menu in Browser and from the Misura menu in
Graphics. 

You find a specific **Data Import** tab where you can enable or disable compatibility mode. After enabling it, click **Save** button (upper-right), then exit
from any opened |m| window. 


======================
Opening |m3| databases
======================

The import function is available both in the Browser and in the Graphics applications. 

------------
From Browser
------------

#. Open the Browser app. Amongst recent items, you will notice a new empty column named **Recent Misura 3 databases**. 
#. If no recent database is listed, open a new one using the ``Add`` button. 
#. You can select a previously opened database from the list of recent paths by double-click or by clicking on ``Open Selected`` button at the bottom of the
   list.

When a database is selected either ways, a Database Dialog opens. Multiple database dialogs can be opened at the same time, remaining active in the Browser's
Database tab.

By double clicking on a test row, the test is converted to the latest |m| format and immediately opened in a new Browser tab. 

Now all advanced Browser operations and functionalities are available. 

-------------
From Graphics
-------------

#. In the Graphics app a new **Misura3** menu appears on the right of standard **Misura** menu, in the top menubar (File, Edit, etc). 
#. **Recent Misura3 databases** submenu lists recently opened databases and lets you open a new one via **Open..** menu action. 
#. When a database is selected, a Database Dialog opens.

By double clicking on a test row, the test is converted to the latest |m| format and immediately added to the current graph.

It is now possible to create beautiful and complex plots out of |m3| data.

-------------------
The Database Dialog
-------------------
The Database Dialog lists all tests contained in the database, in reverse chronological order.

Simple searches against test name can be performed via the text input on the bottom of the list, followed by a click on "Query" button. The listing can also be
restricted by test type, using the chooser menu.

If a selected test contains images, they will be previewed on the bottom of the dialog. 

Below the query input line there are controls about how the format conversion should happen. Using these controls it is possible to force/avoid the overwriting
of any previously converted file.

======================================================
Quick Start: Correcting a Flex test from |m3| database
======================================================

A common task to be performed with |m3| data is to correct a Flex test with its corresponding calibration test. The following Quick Start explains how to
achieve this result in a reversible way. 

-------------------------------
Getting a |m3| example database
-------------------------------
Please download the  `example Misura3 database`_ for a pre-populated database you can use to follow this Quick Start. Extract the folder wherever and point to
the ``misura3_sample.mdb`` file herein contained when asked to open a |m3| database.


=======================================
Opening the output file in Graphics app
=======================================

#. Run ``graphics.exe`` application from the folder where you extracted |m|, or run the link you created on your desktop. 
#. Select **Misura3** menu, **Recent Misura3 databases** submenu, and click on **Open** button. 
#. Browse to the location of your |m3| database, select and open it. 
#. From the Database Dialog, search for a fleximeter test and its calibration test. Double click on each row in the listing in order to open both. 
#. Each file will be converted and loaded into Graphics, then displayed as a tree of datasets in **Misura Navigator** right window area. Both datasets ``d`` (displacement) are already plotted in with two different line styles. 
#. If the **Misura Navigator** area is not visible, you can show/hide it by clicking on menu :menuselection:`Misura --> Opened Tests Navigator`.


Misura :ref:`navigator` is the tree of recorded datasets organized by groups. Each group represents a part of the instrument or of the measurement. 

For example:
    
* ``/|instr|`` element represents the |instrn| instrument itself. It has datasets, but contains one sample (**sample0**).
* ``/kiln`` element represents the furnace, and contains datasets regarding temperature control (T, temperature; S, setpoint; P, power; etc).

==============================
Interacting with the Data Plot
==============================

The :ref:`navigator` tree is the gate to the most important actions you can perform on the data plot. 

In order to plot one more dataset (for example the temperature setpoint):
    
#. Right-click on the dataset you wish to plot on the Navigator tree (``/kiln/S``). 
#. Select the **Plot** action from the context menu.

The same apply for removing a dataset and all its related objects from the plot. The Plot action will be checked if the curve is visible, unchecked if not
visibile.

The setpoint curve plot is now referred to its own axis labelled *S (°C)*. To better compare temperature and setpoint, it is useful to refer the setpoint plot
to the temperature axis:
    
#. Click on the setpoint curve on the plot area window. Visualize the **Properties** area. If it is not visible, click on menu :menuselection:`View --> Windows --> Properties window`. 
#. The Properties area lists all the properties of the plotted curve. Search for the bold **Y axis** entry. 
#. Change **Y axis** from **ax:S** to **ax:T**. The curve will be immediately referred to the *T (°C)* axis.

The *S (°C)* axis loses its scale (it's now from 0 to 1). It's no longer useful, so you can hide it: 

#. Click on the setpoint curve on the plot area window, view **Properties** area. 
#. The first entry is **Hide**. Check the checkbox. The axis disappears.

You can freely move any axis by clicking on it and dragging.

------------------------------
Viewing flexion in micron unit
------------------------------
The ``/flex/sample0/d`` dataset represents flexion. It is recorded in microns and automatically converted to percentile on dataset loading, but is frequently
useful to analyze it as an absolute value in microns. The percentile is calculated towards the distance between the flex rods, set before starting the test. 

Follow these steps to convert the curve back to microns:
    
#. Locate the ``d`` (``/flex/sample0/d``) element in the Navigator. 
#. Right-click and select the flagged action **Percentile**. 
#. A dialog will appear. Click **Apply**. 
#. A new temporary label in the dialog confirms the dataset was created (Done). Click **Close**. 
#. If the curve is currently plotted, you immediately view the effect in the graph. 
#. By right-clicking again on the dataset node the **Percentile** action is now unflagged. 

It may happen that the operator forgot to measure the sample, or inserted a wrong initial dimension. If the thermal treatment modify the structure of your
material, the test must be repeated. In case you are able to recover the correct intial dimension, or you are confident that you can measure it after the test
run, you can change this value on the output file.

#. Locate the ``d`` element in the Navigator tree. 
#. Right-click and select **Set Initial Dimension**. 
#. Insert the correct value in **Initial dimension value**. 
#. De-select *OR, automatic calculation based on first points* checkbox. 
#. Click **Apply** then **Close**. 

If the curve is currently plotted in percentile, you will se the axis scale changing accordingly to the new initial dimension set.

--------------------------------------------------
Correcting sample flexion with a calibration curve
--------------------------------------------------
Once both sample test and calibrationt test are loaded, it is possible to subtract the calibration curve to the test curve.

.. hint:: Although |m| allows to perform operation between curves with unrelated heating cycles, in order for the correction to be meaningful, you should always compare curves obtained with excactly the same heating cycle and starting from approximately the same temperature.

In order to do operations, you should select two datasets at the same time by keeping the Control key pressed while you click on their nodes in the Navigator
tree.

#. Select the ``/flex/sample0/d`` node from the sample test tree you wish to correct. 
#. Keeping the Ctrl (control) key pressed, select the corresponding ``/flex/sample0/d`` node from the calibration test tree.  
#. Having both ``d`` nodes selected, right-click on one of the two and select **Correct**. 
#. A new dialog will open, **Compute: Curve Operation**. Select a new name for the output dataset (eg: correction) in the **Output dataset name** field. 
#. Click **Apply** button. 
#. The Navigator will update showing the new curve as CurveOperation(....). If not, right click in the blank space and select **Update view** action. 

You can plot the corrected dataset as usual by right-click, and compare with the previous, not corrected curve.

.. hint:: The correction dataset node will appear many times in the Navigator tree. It is shown as child of each dataset upon which it depends for its calculation (both ``/flex/sample0/d`` datasets and both ``/kiln/T``). Be careful to execute operation on the node stemming from the sample test root, otherwise it might be performed using wrong temperature or time references.


==============================
Additional Test Configurations
==============================
The most relevant configuration options used for the test run and |m3| conversion can be displayed following these steps:

#. From the **Misura Navigator**, locate the root of the tree corresponding to the test you wish like to view. The root node shows the name of the test and a
(N:) notation, where N is a number >=0.
#. Right click on the root node and select **View** from the context menu.


A Test Window will be opened showing an embedded plot and a **Test Configuration** area. The Test Window is divided in three areas:

* A menu bar in the upper part of the window
* A right area called **Test Configuration**. It is divided in 4 vertical tabs: **Measure**, **Thermal Cycle**, **Sample0** and **Results**.
* A central area displaying movable and resizable sub-windows, where you see the **Data Plot** window.

----------------
Measure overview
----------------
The first **Measure** tab contains the list of options regarding the test run. 

Detect the following:
    
* **Name**: Name of the test run, the same the test had in |m3| database.
* **Comment**: Note about the test, imported from the database.
* **id**: Path of the |m3| database, followed by a vertical bar and the test id (eg: C:\ess\misura.mdb|00137F)
* **uid**: Unique id generated during conversion.
* **Test date**: Date when the test started.
* **Test duration**: Total test duration in seconds. 
    
    
-------------
Thermal cycle
-------------

This tab contains a table with points defining the thermal cycle and a graph with a cartesian representation. 

The graph displays two curves: the red line is the setpoint temperature; the blue line is the heating rate. 

If you cannot see the axes and their labels, enlarge the application window and the Test Configuration area. 
    
-----------
Sample data
-----------

Most relevant data in the Sample0 tab are:
    
* **Name**: The same as Measure name.
* **Comment**: empty label.
* **Initial dimension**: initial dimension set by the operator.
* **Initial width**: only applicable to Microscope tests.
    
.. _example Misura3 database: http://dx.doi.org/10.7910/DVN/9LLJLL
            